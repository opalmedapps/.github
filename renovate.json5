// SPDX-FileCopyrightText: Copyright (C) 2025 Opal Health Informatics Group <https://www.opalmedapps.com>
//
// SPDX-License-Identifier: MIT

{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended",
    // https://docs.renovatebot.com/presets-default/#separatemultiplemajorreleases
    ":separateMultipleMajorReleases",
    // set timezone to local one to ensure schedules are run
    // https://docs.renovatebot.com/configuration-options/#timezone
    ":timezone(America/Toronto)",
    // https://docs.renovatebot.com/presets-default/#configmigration
    ":configMigration",
    "helpers:pinGitHubActionDigestsToSemver",
    "github>mschoettle/renovate-presets//presets/pre-commit-hooks.json5",
  ],
  // https://docs.renovatebot.com/configuration-options/#assignees
  "assignees": ["mschoettle"],
  // https://docs.renovatebot.com/configuration-options/#labels
  "labels": ["dependencies"],
  // Only rebase existing MRs when the branch is conflicted
  // This avoids getting spammed by updates to existing PRs
  //
  // https://docs.renovatebot.com/configuration-options/#rebasewhen
  "rebaseWhen": "conflicted",
  // https://docs.renovatebot.com/configuration-options/#packagerules
  "packageRules": [
    // Exclude markdownlint-cli2 and reuse-tool pre-commit hooks from the pre-commit hooks group
    // to avoid adding config options from the pre-commit hooks preset
    {
      "matchManagers": [
        "pre-commit",
      ],
      "matchPackageNames": [
        "!/markdownlint-cli2/",
        "!/reuse-tool/",
      ],
    },
    // Combine markdownlint-cli2 updates
    {
      "matchPackageNames": ["/markdownlint-cli2/"],
      "groupName": "markdownlint-cli2",
    },
    // Combine reuse-tool and reuse-action updates
    {
      "matchPackageNames": ["/reuse-tool/", "/reuse-action/"],
      "groupName": "reuse",
    },
  ],
  // add custom manager for pinning version in GitHub action docker-run specifying a container image
  "customManagers": [
    {
      "customType": "regex",
      "managerFilePatterns": ["/^.github/workflows/[^/]*\\.ya?ml$/"],
      "matchStrings": [
        "(?:image:\\s*)(?<depName>[\\S]+?):(?<currentValue>[^@\\s]+)(?:@(?<currentDigest>sha256:[a-f0-9]+))?",
      ],
      "datasourceTemplate": "docker",
      "versioningTemplate": "docker",
    }
  ],
}
