<!--
# SPDX-FileCopyrightText: Copyright (C) 2025 Opal Health Informatics Group <https://www.opalmedapps.com>
#
# SPDX-License-Identifier: CC-BY-SA-4.0
-->

# Welcome to Opal

Opal is the open-source patient-in-the-loop data platform.

We define patient-in-the-loop data as health data, with helpful explanations, that are shared in real-time with the patient (or their informal caregivers) just as they are with the other (professional) members of the patientâ€™s care team.

## Opal is now open source ðŸŽ‰

We have recently (March 2025) open sourced Opal!
Some things might still need to be polished a bit.
Feel free to let us know if you spot anything, or maybe even contribute ðŸ™‚

## Getting started

### Quick start

- Documentation on Opal's architecture: https://docs.opalmedapps.com/development/architecture/
- Setting up your local development environment: https://docs.opalmedapps.com/development/local-dev-setup/
- Deploying Opal: https://docs.opalmedapps.com/install/

### Resources

- Opal Website: https://www.opalmedapps.com
- Opal community page: https://www.opalmedapps.com/community
- Documentation: https://docs.opalmedapps.com
- Community discussions: https://github.com/orgs/opalmedapps/discussions

## Architecture Overview

![Opal Architecture Schematic](https://docs.google.com/drawings/d/e/2PACX-1vR7Sent6KQ2P7F089NHy446OZjPXaM040pd8ggriCfZhKaWYTM-I2EMrCTTqYohCGfx0C9mXwrCPZ8C/pub?w=1638&h=902)

At a high-level, the ***Opal patient-in-the-loop data*** platformâ€™s architecture is quite simple. The platformâ€™s primary goal is to securely share data across the firewall of a healthcare institutionâ€™s protected network between the patientâ€™s Opal app and their medical record in the hospitalâ€™s source systems.

> [!NOTE]
> In the Details text below, components of the Opal platform that have their own Github repositories are shown in parenthesis. These are also shown in purple in the diagram above. There is no repository for the Opal Integration Engine as this is a hospital-specific integration system. The repositories for the Live Clinic Management Dashboards (virtual waiting room and clinician dashboard) and the Realtime Database have not yet been added to Github. Please check back soon for them.

<details>
  
### Registration

Patients register for an Opal account using a QR code that is generated by healthcare professionals inside the hospital using the OpalADMIN application (opal-admin and opal-admin-legacy). On their phone or browser, the patient accesses the Opal registration webpage (opal-registration) from which they securely communicate with the hospitalâ€™s Opal database via the Realtime Databsae of the Cloud Relay service (currently Firebase by Google Cloud) and the Opal Listener (opal-listener) application running inside the hospital. Once registered, the patient is provided with their own personal account on the Cloud Relay service using which they can access their hospital data via the Opal app (opal-app).

### The Opal App and Cloud Relay Service

To retrieve their data from the hospital, the patient logs into their personal Opal account using the Opal App on their phone or browser (opal-app). Upon authentication with the Cloud Relay, the patient essentially places a request for their data on the Realtime Database. 

**Note:** the patient never logs into the hospital directly and the hospitalâ€™s servers are never directly exposed to the internet. 

### The Opal Listener

The Opal Listener (opal-listener) inside the hospital monitors the Realtime Databse for requests from authenticated patients. When an authenticated request is received, the listener fetches the data from the Opal database, encrypts the data so that only the patient can decrypt them and puts them onto the Realtime Database on the external Cloud Relay service from where the patientâ€™s Opal Patient Portal App (opal-app) then downloads them onto the patientâ€™s phone or browser. In a similar way, the patient can send data into the hospital, such as by answering clinical questionnaires.

**Note:** to protect the patientâ€™s privacy at all times, the data are doubly encrypted. First, the Cloud Relay service encrypts all communication with it (thick red lines in the diagram). Second, the data are further encrypted so that the Cloud Relay Service cannot read them (blue arrows in the diagram), ensuring that only the Opal platform in the hospital and the Opal Patient Portal App can access the unencrypted data.

### OpalADMIN

The OpalADMIN (opal-admin and opal-admin-legacy) application is used by the clinical and administrative staff to set up the rules for publishing data to patients (which data from the source systems and how the data are presented to the patient \- eg aliasing of clinical terms and provision of additional explanatory content).

### The OPAL PIE

The Opal PIE is the Opal Patient Information Exchange. It is essentially the complete Opal solution inside the hospitalâ€™s network, comprising opal-listener, opal-admin, opal-admin-legacy and the Opal databases.
</details>

## Overview of our repositories

The following repositories are available.
Repositories that begin with "opal" are components of the Opal platform.

- **opal-app:** The patient-facing web and mobile application (referred to as the _Opal Patient Portal_) used by users to access their patient data. [JavaScript, AngularJS, Cordova, Onsen UI].

- **opal-admin:** The staff-facing web application (referred to as _OpalADMIN_) used to create and manage the publishing of data and education materials to patients as well as access management for patients and staff (clinicians and administrative personnel).
  Note: This repository is Python/Django-based and contains the code base for all new features and functionality to OpalADMIN. [Python, Django]

- **opal-admin-legacy:** The staff-facing web application (referred to as _OpalADMIN Legacy_) used to create and manage the publishing of data and education materials to patients as well as access management for patients and staff (clinicians and administrative personnel).
  Note: this repository is PHP and Perl-based and contains the legacy version of OpalADMIN.
  It is used for maintenance-only development and should not be used to develop any new features or functionality. [PHP, Perl, JavaScript, AngularJS]

- **opal-listener:** The Opal listener application (referred to as the _Opal Listener_) that runs in the background and handles requests from the Opal Patient Portal and the Opal Registration site via Firebase. [Node.js]

- **opal-registration:** The public-facing webpage (referred to as the _Opal Registration site_) where Opal users can create their Opal accounts. [JavaScript, AngularJS]

- **opal-db-management:** Opal's database utility used to manage revisions and data for the Opal legacy databases.
  Note: The current Opal database is managed using the Django framework in `opal-admin`. [Alembic, Python, MySQL]

- **deploy-pie:** Copier template to deploy the Opal PIE.
  The Opal PIE is the Opal Patient Information Exchange, consisting of the Opal Listener, OpalADMIN, OpalADMIN Legacy, and all associated databases and scripts.

- **docs:** Opal's documentation site written in Markdown. [MkDocs, mkdocs-material]
